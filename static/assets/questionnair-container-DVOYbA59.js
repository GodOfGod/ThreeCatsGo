var pe=Object.defineProperty;var ce=(f,t,l)=>t in f?pe(f,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):f[t]=l;var G=(f,t,l)=>ce(f,typeof t!="symbol"?t+"":t,l);import{N as me,i as O}from"./nav-bar-C_ljxWw8.js";/* empty css                 *//* empty css                  */import{_ as Z}from"./logo-BaDEpkr8.js";import{k as A,ai as fe,aj as ye,c as M,l as u,m as k,q as y,C as h,y as _,z as m,F as I,W as Q,E as g,D as q,T as ve,r as T,ak as ge,f as _e,u as ke,al as xe,v as he}from"./common-gXMv56uI.js";import{P as Y,Q as Te,R as qe,S as H,T as Ve,U as we,V as P,q as Ce,W as N,X as Re,Y as be}from"./elementPlus-Bg1TOGvz.js";import{_ as ee,r as Ee}from"./index-D6wk3Emy.js";const Se={class:"questionnaire-item"},Be={class:"title-container"},Ne={class:"title-order"},Ue={class:"title-string"},$e={key:0,class:"required-icon"},De={class:"input-container"},Je={key:0,class:"remark-container"},Le=A({__name:"questionnair-item",props:fe({order:{},field:{},title:{},required:{type:Boolean},inputType:{},needRemark:{type:Boolean},options:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const t=ye(f,"modelValue"),l=M(()=>JSON.parse(f.options)),d=M({get(){let a=[];try{a=JSON.parse(t.value)}catch(s){console.log(s),a=[]}return a},set(a){t.value=JSON.stringify(a)}});return(a,s)=>{const U=Te,D=qe,C=H,J=Ve,L=we,$=P;return u(),k("div",Se,[y("div",Be,[y("span",Ne,Y(a.order)+"、",1),y("span",Ue,Y(a.title),1),a.required?(u(),k("span",$e,"*")):h("",!0)]),y("div",De,[a.inputType==="radio"?(u(),_(D,{key:0,modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=p=>t.value=p)},{default:m(()=>[(u(!0),k(I,null,Q(l.value,p=>(u(),_(U,{key:p,value:p,label:p},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):a.inputType==="input"?(u(),_(C,{key:1,modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=p=>t.value=p)},null,8,["modelValue"])):a.inputType==="textarea"?(u(),_(C,{key:2,modelValue:t.value,"onUpdate:modelValue":s[2]||(s[2]=p=>t.value=p),type:"textarea",rows:4},null,8,["modelValue"])):a.inputType==="checkbox"?(u(),_(L,{key:3,modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=p=>d.value=p)},{default:m(()=>[(u(!0),k(I,null,Q(l.value,p=>(u(),_(J,{key:p,value:p,label:p},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):h("",!0)]),a.needRemark?(u(),k("div",Je,[g($,{type:"info"},{default:m(()=>s[4]||(s[4]=[q("备注")])),_:1}),g(C,{type:"textarea"})])):h("",!0)])}}}),Oe=ee(Le,[["__scopeId","data-v-8bff1c96"]]),Me=[{field:"name",title:"宠物昵称",required:!0,inputType:"input",needRemark:!1},{field:"age",title:"宠物年龄",required:!0,inputType:"input",needRemark:!1},{field:"gender",title:"宠物性别",required:!0,inputType:"radio",needRemark:!1,options:["Boy","Girl"]},{field:"fertile",title:"是否绝育",required:!0,inputType:"radio",needRemark:!1,options:["纯原生","已噶"]},{field:"vaccine",title:"疫苗情况",required:!0,inputType:"input",needRemark:!1},{field:"health",title:"健康情况",required:!0,inputType:"input",needRemark:!1},{field:"personality",title:"性格",required:!0,inputType:"input",needRemark:!1},{field:"play",title:"是否需要陪玩",required:!0,inputType:"radio",needRemark:!1,options:["需要","不用啦"]},{field:"food",title:"食物偏好及食量",required:!0,inputType:"input",needRemark:!1},{field:"phone",title:"手机号",required:!0,inputType:"input",needRemark:!1}],Ie=(f,t)=>{const l={},d=t.concat(Me);return f.map(a=>{const s=d.find(U=>U.field===a);s&&(l[a]={value:"",title:s.title})}),l},ze={key:0,class:"complete"},We=A({__name:"complete-ending",props:{show:Boolean},setup(f){return(t,l)=>(u(),_(ve,null,{default:m(()=>[f.show?(u(),k("div",ze,l[0]||(l[0]=[y("div",{class:"logo-container"},[y("img",{src:Z,alt:""}),y("div",{class:"tip-text"},"提交成功")],-1)]))):h("",!0)]),_:1}))}}),Xe=ee(We,[["__scopeId","data-v-fc97dd25"]]);class K{constructor(t,l=1){G(this,"ctx");G(this,"dpr");this.ctx=t,this.dpr=l}moveTo(t,l){this.ctx.moveTo(t*this.dpr,l*this.dpr)}lineTo(t,l){this.ctx.lineTo(t*this.dpr,l*this.dpr)}arc(t,l,d,a,s){this.ctx.arc(t*this.dpr,l*this.dpr,d*this.dpr,a,s)}fillText(t,l,d){this.ctx.fillText(t,l*this.dpr,d*this.dpr)}}const Fe={class:"remark"},Ge={class:"custom-title"},Qe={class:"info-text"},tt=A({__name:"questionnair-container",setup(f){const t=T({}),l=T(),d=xe(),a=T(""),s=T(""),U=T(!1),D=T([]),C=ge("containerRef"),J=T(""),L=T(!1),$=T(!1),p=M(()=>d.query.type==="edit"?"编辑":d.query.type==="check"?"查看":""),te=M(()=>d.query?["edit","check"].includes(d.query.type):!1),R=M(()=>!!d.params.id),oe=async(o="")=>{try{const{data:e}=await O.get("/question/get_questionnaire_config_by_id",{params:{config_id:o}}),r=JSON.parse(e.custom_config_fields);D.value=r.map(n=>{const c=e.questionnaire_item_list.find(v=>v.field===n);return{...c,inputType:c.input_type,needRemark:!1,required:!0}}),R.value||(t.value=Ie(r,e.questionnaire_item_list))}catch(e){console.log(e)}},ne=async o=>{var e;try{const r=await O.get("/question/get_questionnaire_by_id",{params:{id:o}});l.value=r.data;const n=JSON.parse(((e=r.data)==null?void 0:e.questionnaire)??JSON.stringify({}));t.value=n,a.value=(n==null?void 0:n.remark)??"",s.value=(n==null?void 0:n.main_title)??""}catch(r){console.error("Error fetching order info:",r)}};_e(async()=>{const o=d.params;o.id&&await ne(o.id),J.value=d.query.config_id??"",await oe(d.query.config_id),U.value=!0});const le=async()=>{if(!J.value){N({message:"啊哦～出现了一些问题",type:"error"});return}try{R.value?await ie():(L.value=!0,await ae())}catch(o){console.log(o)}},ae=async()=>{try{await O.post("/question/submit_questionnaire",{questionnaire:JSON.stringify(t.value),date:new Date().toLocaleDateString(),config_id:J.value}),N({message:"提交成功",type:"success",offset:100})}catch(o){console.log(o),N({message:"提交失败，请直接联系我",type:"error",offset:100})}},ie=async()=>{var o;try{await O.post("/question/update_questionnaire",{id:d.params.id,questionnaire:JSON.stringify({...t.value,remark:a.value,main_title:s.value}),date:(o=l.value)==null?void 0:o.date}),N({message:"修改成功",type:"success",offset:100})}catch(e){console.log(e),N({message:"修改失败，请直接联系我",type:"error",offset:100})}},se=async()=>{$.value=!0},re=async()=>{try{await O.delete("/question/delete_questionnaire_by_id",{params:{id:d.params.id}}),N({message:"删除成功",type:"success",offset:100}),Ee.push({name:"manage-home"})}catch(o){console.log(o),N({message:"删除失败，请直接联系我",type:"error",offset:100})}},ue=async()=>{var X;const o=document.createElement("canvas"),e=(X=C.value)==null?void 0:X.getBoundingClientRect(),r=((e==null?void 0:e.width)??600)+40,n=((e==null?void 0:e.height)??600)-200,c=window.devicePixelRatio||1;o.width=r*c,o.height=n*c,o.style.width=`${r}px`,o.style.height=`${n}px`,o.style.backgroundColor="#fff";const v=o.getContext("2d"),i={originX:30,originY:30,x:30,y:30},b=10,V=20,x=110;if(v){v.fillStyle="black",D.value.forEach(F=>{const{title:B,value:de}=t.value[F.field];j({value:de,title:B},v,i,V,o,x,b)}),a.value&&j({value:a.value,title:"备注"},v,i,V,o,x,b);const E={x:i.originX-8,y:i.originY-9},S={x:i.originX-8,y:i.y},z={x:i.originX-8+o.width/c-50,y:i.originY-9},W={x:i.x-8+o.width/c-50,y:i.y},w=new K(v,c);v.beginPath(),w.moveTo(E.x,E.y),w.lineTo(S.x,i.y),w.moveTo(E.x+x,E.y),w.lineTo(S.x+x,S.y),w.moveTo(z.x,z.y),w.lineTo(W.x,W.y),w.moveTo(S.x,S.y),w.lineTo(W.x,W.y),v.stroke(),o.toBlob(F=>{const B=document.createElement("a");B.href=URL.createObjectURL(F),B.download=`${t.value.address.value}-${t.value.name.value}.png`,document.body.appendChild(B),B.click(),B.remove()})}},j=({value:o,title:e},r,n,c,v,i=80,b=10)=>{const V=window.devicePixelRatio||1,x=new K(r,V);if(n.y+=b,r.beginPath(),r.lineWidth=.5,x.moveTo(n.x-8,n.y-c),x.lineTo(n.x-8+v.width/V-50,n.y-c),r.stroke(),r.font=`${12*V}px Arial`,x.fillText(e,n.x,n.y),o.length>20){const E=o.match(/.{1,20}/g);E.forEach((S,z)=>{x.fillText(S,n.x+i,n.y+z*c)}),n.y=n.y+E.length*c}else x.fillText(o,n.x+i,n.y),n.y+=c};return(o,e)=>{const r=Re,n=P,c=H,v=be;return u(),k(I,null,[g(Xe,{show:L.value},null,8,["show"]),L.value?h("",!0):(u(),k("div",{key:0,class:"scroll-container",ref_key:"containerRef",ref:C},[U.value?(u(),k("div",{key:0,class:Ce(["questionnaire-container",{"is-modifying":R.value}])},[te.value?(u(),_(me,{key:0,title:p.value,scrollerRef:ke(C)},{right:m(()=>[R.value?(u(),_(r,{key:0,style:{width:"70px"},type:"primary",onClick:ue},{default:m(()=>e[4]||(e[4]=[q("下载")])),_:1})):h("",!0)]),_:1},8,["title","scrollerRef"])):h("",!0),e[9]||(e[9]=y("img",{class:"logo",src:Z,alt:""},null,-1)),e[10]||(e[10]=y("div",{class:"main-title"},"上门喂养信息收集",-1)),(u(!0),k(I,null,Q(D.value,(i,b)=>(u(),_(Oe,he({order:b+1,key:b,ref_for:!0},i,{modelValue:t.value[i.field].value,"onUpdate:modelValue":V=>t.value[i.field].value=V}),null,16,["order","modelValue","onUpdate:modelValue"]))),128)),R.value?(u(),k(I,{key:1},[y("div",Fe,[g(n,{type:"danger",style:{fontSize:"28px"}},{default:m(()=>e[5]||(e[5]=[q("备注")])),_:1}),g(c,{type:"textarea",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=i=>a.value=i),autosize:{minRows:5}},null,8,["modelValue"])]),y("div",Ge,[g(n,{type:"danger",style:{fontSize:"28px"}},{default:m(()=>e[6]||(e[6]=[q("标题")])),_:1}),g(c,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=i=>s.value=i)},null,8,["modelValue"])])],64)):h("",!0),g(r,{class:"submit-btn",type:"primary",onClick:le},{default:m(()=>[q(Y(R.value?"修改":"交给你啦"),1)]),_:1}),R.value?(u(),_(r,{key:2,class:"submit-btn",type:"danger",onClick:se},{default:m(()=>e[7]||(e[7]=[q("删除")])),_:1})):h("",!0),y("div",Qe,[g(n,{type:"info"},{default:m(()=>e[8]||(e[8]=[q("我们将严格保密您的信息，仅用于服务安排。")])),_:1})])],2)):h("",!0)],512)),g(v,{modelValue:$.value,"onUpdate:modelValue":e[3]||(e[3]=i=>$.value=i)},{header:m(()=>e[11]||(e[11]=[y("span",null,"删除",-1)])),footer:m(()=>[g(r,{type:"primary",onClick:re},{default:m(()=>e[12]||(e[12]=[q("确认")])),_:1}),g(r,{onClick:e[2]||(e[2]=i=>$.value=!1)},{default:m(()=>e[13]||(e[13]=[q("取消")])),_:1})]),default:m(()=>[e[14]||(e[14]=y("span",null,"确认删除该问卷",-1))]),_:1},8,["modelValue"])],64)}}});export{tt as default};

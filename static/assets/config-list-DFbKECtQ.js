import{x as L,aD as X,y as u,z as g,O as q,P as c,H as d,G as T,ag as f,L as y,M as x,r as V,A as p,u as H,a4 as O,K as U,C as K,k as Y,V as j}from"./common-DoM3tTau.js";import{i as D,N as Z}from"./nav-bar-CzScn_om.js";import{_ as B,a as F,E as Q,r as ee}from"./index-CTVEOp0v.js";const ne={class:"opt-btns"},te=L({__name:"create-opt-btns",props:X({isCreating:Boolean,createText:String,confirmText:String,cancelText:String},{createText:"创建",confirmText:"保存",cancelText:"取消"}),emits:["onCreate","onCancel","onConfirm"],setup(n,{emit:l}){const r=l;return(e,o)=>{const m=f("el-button");return u(),g("div",ne,[n.isCreating?(u(),g(q,{key:0},[c(m,{type:"primary",onClick:o[0]||(o[0]=I=>r("onConfirm"))},{default:d(()=>[y(x(n.confirmText),1)]),_:1}),c(m,{type:"danger",onClick:o[1]||(o[1]=I=>r("onCancel"))},{default:d(()=>[y(x(n.cancelText),1)]),_:1})],64)):(u(),T(m,{key:1,type:"primary",onClick:o[2]||(o[2]=I=>r("onCreate"))},{default:d(()=>[y(x(n.createText),1)]),_:1}))])}}}),P=B(te,[["__scopeId","data-v-84236be6"]]),v=[];for(let n=0;n<256;++n)v.push((n+256).toString(16).slice(1));function oe(n,l=0){return(v[n[l+0]]+v[n[l+1]]+v[n[l+2]]+v[n[l+3]]+"-"+v[n[l+4]]+v[n[l+5]]+"-"+v[n[l+6]]+v[n[l+7]]+"-"+v[n[l+8]]+v[n[l+9]]+"-"+v[n[l+10]]+v[n[l+11]]+v[n[l+12]]+v[n[l+13]]+v[n[l+14]]+v[n[l+15]]).toLowerCase()}let M;const le=new Uint8Array(16);function ie(){if(!M){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");M=crypto.getRandomValues.bind(crypto)}return M(le)}const ae=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),G={randomUUID:ae};function se(n,l,r){if(G.randomUUID&&!l&&!n)return G.randomUUID();n=n||{};const e=n.random||(n.rng||ie)();return e[6]=e[6]&15|64,e[8]=e[8]&63|128,oe(e)}const ue={key:0,class:"question-container"},re={class:"preview"},ce=L({__name:"create-question-item",emits:["on-confirm"],setup(n,{emit:l}){const r=[{label:"文本",value:"input"},{label:"单选",value:"radio"},{label:"多选",value:"checkbox"},{label:"长文本",value:"textarea"}],e=V({field:"",title:"",required:!0,inputType:"input",needRemark:!1,options:[]}),o=V({str:"",arr:[]}),m=V(!1),I=l,h=()=>{m.value=!0},w=async()=>{m.value=!1,await D.post("/question/create_new_question",{...e.value,field:se(),input_type:e.value.inputType,options:JSON.stringify(e.value.options)}),o.value.arr=[],o.value.str="",e.value.field="",e.value.title="",e.value.inputType="",e.value.options=[],I("on-confirm")},_=()=>{m.value=!1};return(N,a)=>{const b=f("el-option"),S=f("el-select"),R=f("el-input-tag"),E=f("el-radio"),s=f("el-radio-group"),t=f("el-checkbox"),k=f("el-checkbox-group");return u(),g("div",{class:K(["create-question",{"is-creating":m.value}])},[m.value?(u(),g("div",ue,[a[8]||(a[8]=p("h3",null,"问题",-1)),c(H(F),{modelValue:e.value.title,"onUpdate:modelValue":a[0]||(a[0]=i=>e.value.title=i),placeholder:"问题"},null,8,["modelValue"]),a[9]||(a[9]=p("h3",null,"问题类型",-1)),c(S,{placeholder:"问题类型",modelValue:e.value.inputType,"onUpdate:modelValue":a[1]||(a[1]=i=>e.value.inputType=i)},{default:d(()=>[(u(),g(q,null,O(r,i=>c(b,{key:i.value,label:i.label,value:i.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),["radio","checkbox"].includes(e.value.inputType)?(u(),g(q,{key:0},[a[6]||(a[6]=p("h3",null,"选项",-1)),c(R,{modelValue:e.value.options,"onUpdate:modelValue":a[2]||(a[2]=i=>e.value.options=i),draggable:"",clearable:""},null,8,["modelValue"])],64)):U("",!0),p("div",re,[a[7]||(a[7]=p("h3",null,"预览",-1)),p("div",null,x(e.value.title),1),["input","textarea"].includes(e.value.inputType)?(u(),T(H(F),{key:0,type:e.value.inputType,"min-line":4,modelValue:o.value.str,"onUpdate:modelValue":a[3]||(a[3]=i=>o.value.str=i)},null,8,["type","modelValue"])):U("",!0),e.value.inputType==="radio"?(u(),T(s,{key:1,modelValue:o.value.str,"onUpdate:modelValue":a[4]||(a[4]=i=>o.value.str=i)},{default:d(()=>[(u(!0),g(q,null,O(e.value.options,(i,$)=>(u(),T(E,{key:i+$,value:i},{default:d(()=>[y(x(i),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):U("",!0),e.value.inputType==="checkbox"?(u(),T(k,{key:2,modelValue:o.value.arr,"onUpdate:modelValue":a[5]||(a[5]=i=>o.value.arr=i)},{default:d(()=>[(u(!0),g(q,null,O(e.value.options,(i,$)=>(u(),T(t,{key:i+$,label:i},{default:d(()=>[y(x(i),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])):U("",!0)])])):U("",!0),c(P,{"is-creating":m.value,"create-text":"创建问题",onOnCancel:_,onOnConfirm:w,onOnCreate:h},null,8,["is-creating"])],2)}}}),de=B(ce,[["__scopeId","data-v-c61a47f9"]]),pe={key:0},ve={class:"questionnaire-item-list"},me=L({__name:"create-questionnaire",props:{newQuestionnaire:{}},emits:["on-add-config","on-remove-question","on-clear-new-question"],setup(n,{emit:l}){const r=V(""),e=V(!1),o=l,m=()=>{e.value=!0},I=()=>{e.value=!1,o("on-clear-new-question"),r.value=""},h=async()=>{if(n.newQuestionnaire.length<=0)return;if(!r.value){Q({message:"请填写问卷标题",type:"warning"});return}const{data:w}=await D.post("/question/create_questionnaire",{config_fields:JSON.stringify(n.newQuestionnaire.map(_=>_.field)),title:r.value});w.config_fields.length&&o("on-add-config",{...w,config_fields:JSON.parse(w.config_fields)}),Q({message:"创建问卷成功",type:"success"}),e.value=!1,o("on-clear-new-question"),r.value=""};return(w,_)=>{const N=f("el-input"),a=f("el-tag");return u(),g("div",{class:K(["create-question",{"is-creating":e.value}])},[e.value?(u(),g("div",pe,[_[1]||(_[1]=p("h3",null,"问卷标题",-1)),c(N,{modelValue:r.value,"onUpdate:modelValue":_[0]||(_[0]=b=>r.value=b)},null,8,["modelValue"]),_[2]||(_[2]=p("h3",null,"问题",-1)),p("div",ve,[(u(!0),g(q,null,O(w.newQuestionnaire,b=>(u(),T(a,{key:b.field,closable:"",effect:"dark",type:"success",onClose:S=>w.$emit("on-remove-question",b)},{default:d(()=>[y(x(b.title),1)]),_:2},1032,["onClose"]))),128))])])):U("",!0),c(P,{"is-creating":e.value,"create-text":"创建问卷",onOnCancel:I,onOnConfirm:h,onOnCreate:m},null,8,["is-creating"])],2)}}}),fe=B(me,[["__scopeId","data-v-74955041"]]),ge={class:"config-list-container"},_e={class:"questionnaire-item-container"},ye={class:"questionnaire-item-list"},Ce={class:"create-questionnaire create-container"},we={class:"config-list"},ke=["onClick"],xe={class:"opts"},be=L({__name:"config-list",setup(n){const l=V(),r=V([]),e=V([]),o=V({configId:"",show:!1});Y(()=>{I(),m()});const m=async()=>{const{data:s}=await D.get("/question/get_questionnaire_item_list");l.value=s},I=async()=>{var t;const{data:s}=await D.get("/question/get_questionnaire_config");(t=s.custom_config_list)!=null&&t.length&&(r.value=s.custom_config_list.map(k=>({...k,config_fields:JSON.parse(k.config_fields)})))},h=s=>{ee.push({name:"questionnaire",query:{config_id:s,type:"check"}})},w=async()=>{o.value.show=!1;const s=r.value.findIndex(t=>t.id==o.value.configId);if(s>=0)r.value.splice(s,1);else{Q({message:"删除问卷配置失败",type:"error"});return}await D.delete("/question/delete_questionnaire_config_by_id",{params:{config_id:o.value.configId}}),Q({message:"删除问卷配置成功",type:"success"})},_=s=>{o.value.configId=s,o.value.show=!0},N=()=>{o.value.show=!1,o.value.configId=""},a=async s=>{try{const t=`${window.location.origin}/questionnaire/v1#questionnaire?config_id=${s}`;await navigator.clipboard.writeText(t),Q({message:"复制链接成功",type:"success"})}catch(t){Q({message:"复制链接失败",type:"error"}),console.error("Error copying text to clipboard:",t)}},b=s=>{if(e.value.find(k=>k.field==s.field)){Q({message:"该问题项已添加",type:"warning"});return}e.value.push(s)},S=s=>{r.value.push(s)},R=s=>{const t=e.value.findIndex(k=>k.field==s.field);t>=0&&e.value.splice(t,1)},E=()=>{e.value=[]};return(s,t)=>{const k=f("el-text"),i=f("el-tag"),$=f("el-link"),A=f("el-button"),W=f("el-dialog");return u(),g(q,null,[p("div",ge,[c(Z,{"show-back-icon":!1,title:"问卷配置"}),p("div",_e,[c(k,{style:{fontSize:"28px"}},{default:d(()=>t[1]||(t[1]=[y("问题项")])),_:1}),p("div",ye,[(u(!0),g(q,null,O(l.value,C=>(u(),T(i,{key:C.field,onClick:J=>b(C)},{default:d(()=>[y(x(C.title),1)]),_:2},1032,["onClick"]))),128))])]),p("div",Ce,[c(de,{onOnConfirm:m}),c(fe,{"new-questionnaire":e.value,onOnAddConfig:S,onOnClearNewQuestion:E,onOnRemoveQuestion:R},null,8,["new-questionnaire"])]),p("div",we,[(u(!0),g(q,null,O(r.value,(C,J)=>(u(),g("div",{class:"config-item",key:C.id,underline:!1,onClick:z=>h(C.id)},[p("span",null,x(J+1)+"、"+x(C.title),1),p("div",xe,[c($,{type:"primary",onClick:j(z=>a(C.id),["stop"])},{default:d(()=>t[2]||(t[2]=[y("复制链接")])),_:2},1032,["onClick"]),c($,{type:"danger",onClick:j(z=>_(C.id),["stop"])},{default:d(()=>t[3]||(t[3]=[y("删除")])),_:2},1032,["onClick"])])],8,ke))),128))])]),c(W,{modelValue:o.value.show,"onUpdate:modelValue":t[0]||(t[0]=C=>o.value.show=C)},{header:d(()=>t[4]||(t[4]=[p("span",null,"删除",-1)])),footer:d(()=>[c(A,{type:"danger",onClick:w},{default:d(()=>t[5]||(t[5]=[y("确认")])),_:1}),c(A,{onClick:N},{default:d(()=>t[6]||(t[6]=[y("取消")])),_:1})]),default:d(()=>[t[7]||(t[7]=p("span",null,"确认删除该问卷配置",-1))]),_:1},8,["modelValue"])],64)}}}),Te=B(be,[["__scopeId","data-v-0bf03b19"]]);export{Te as default};

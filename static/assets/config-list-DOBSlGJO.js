import{i as O,N as Y}from"./nav-bar-C_ljxWw8.js";/* empty css                 *//* empty css                  */import{k as N,am as Z,l as u,m as f,F as q,E as d,z as c,y as T,D as _,r as b,q as p,u as F,W as U,C as $,f as ee,K as G}from"./common-gXMv56uI.js";import{_ as S,r as ne}from"./index-D6wk3Emy.js";import{X as j,P as k,S as J,q as H,Z as te,_ as oe,$ as le,Q as ae,R as ie,T as se,U as ue,W as I,a0 as K,V as re,Y as de,a1 as ce}from"./elementPlus-Bg1TOGvz.js";const pe={class:"opt-btns"},me=N({__name:"create-opt-btns",props:Z({isCreating:Boolean,createText:String,confirmText:String,cancelText:String},{createText:"创建",confirmText:"保存",cancelText:"取消"}),emits:["onCreate","onCancel","onConfirm"],setup(n,{emit:l}){const r=l;return(e,o)=>{const v=j;return u(),f("div",pe,[n.isCreating?(u(),f(q,{key:0},[d(v,{type:"primary",onClick:o[0]||(o[0]=V=>r("onConfirm"))},{default:c(()=>[_(k(n.confirmText),1)]),_:1}),d(v,{type:"danger",onClick:o[1]||(o[1]=V=>r("onCancel"))},{default:c(()=>[_(k(n.cancelText),1)]),_:1})],64)):(u(),T(v,{key:1,type:"primary",onClick:o[2]||(o[2]=V=>r("onCreate"))},{default:c(()=>[_(k(n.createText),1)]),_:1}))])}}}),P=S(me,[["__scopeId","data-v-84236be6"]]),m=[];for(let n=0;n<256;++n)m.push((n+256).toString(16).slice(1));function ve(n,l=0){return(m[n[l+0]]+m[n[l+1]]+m[n[l+2]]+m[n[l+3]]+"-"+m[n[l+4]]+m[n[l+5]]+"-"+m[n[l+6]]+m[n[l+7]]+"-"+m[n[l+8]]+m[n[l+9]]+"-"+m[n[l+10]]+m[n[l+11]]+m[n[l+12]]+m[n[l+13]]+m[n[l+14]]+m[n[l+15]]).toLowerCase()}let B;const fe=new Uint8Array(16);function ge(){if(!B){if(typeof crypto>"u"||!crypto.getRandomValues)throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");B=crypto.getRandomValues.bind(crypto)}return B(fe)}const _e=typeof crypto<"u"&&crypto.randomUUID&&crypto.randomUUID.bind(crypto),W={randomUUID:_e};function ye(n,l,r){if(W.randomUUID&&!l&&!n)return W.randomUUID();n=n||{};const e=n.random||(n.rng||ge)();return e[6]=e[6]&15|64,e[8]=e[8]&63|128,ve(e)}const Ce={key:0,class:"question-container"},we={class:"preview"},ke=N({__name:"create-question-item",emits:["on-confirm"],setup(n,{emit:l}){const r=[{label:"文本",value:"input"},{label:"单选",value:"radio"},{label:"多选",value:"checkbox"},{label:"长文本",value:"textarea"}],e=b({field:"",title:"",required:!0,inputType:"input",needRemark:!1,options:[]}),o=b({str:"",arr:[]}),v=b(!1),V=l,E=()=>{v.value=!0},C=async()=>{v.value=!1,await O.post("/question/create_new_question",{...e.value,field:ye(),input_type:e.value.inputType,options:JSON.stringify(e.value.options)}),o.value.arr=[],o.value.str="",e.value.field="",e.value.title="",e.value.inputType="",e.value.options=[],V("on-confirm")},g=()=>{v.value=!1};return(D,i)=>{const x=te,h=oe,R=le,L=ae,s=ie,t=se,w=ue;return u(),f("div",{class:H(["create-question",{"is-creating":v.value}])},[v.value?(u(),f("div",Ce,[i[8]||(i[8]=p("h3",null,"问题",-1)),d(F(J),{modelValue:e.value.title,"onUpdate:modelValue":i[0]||(i[0]=a=>e.value.title=a),placeholder:"问题"},null,8,["modelValue"]),i[9]||(i[9]=p("h3",null,"问题类型",-1)),d(h,{placeholder:"问题类型",modelValue:e.value.inputType,"onUpdate:modelValue":i[1]||(i[1]=a=>e.value.inputType=a)},{default:c(()=>[(u(),f(q,null,U(r,a=>d(x,{key:a.value,label:a.label,value:a.value},null,8,["label","value"])),64))]),_:1},8,["modelValue"]),["radio","checkbox"].includes(e.value.inputType)?(u(),f(q,{key:0},[i[6]||(i[6]=p("h3",null,"选项",-1)),d(R,{modelValue:e.value.options,"onUpdate:modelValue":i[2]||(i[2]=a=>e.value.options=a),draggable:"",clearable:""},null,8,["modelValue"])],64)):$("",!0),p("div",we,[i[7]||(i[7]=p("h3",null,"预览",-1)),p("div",null,k(e.value.title),1),["input","textarea"].includes(e.value.inputType)?(u(),T(F(J),{key:0,type:e.value.inputType,"min-line":4,modelValue:o.value.str,"onUpdate:modelValue":i[3]||(i[3]=a=>o.value.str=a)},null,8,["type","modelValue"])):$("",!0),e.value.inputType==="radio"?(u(),T(s,{key:1,modelValue:o.value.str,"onUpdate:modelValue":i[4]||(i[4]=a=>o.value.str=a)},{default:c(()=>[(u(!0),f(q,null,U(e.value.options,(a,Q)=>(u(),T(L,{key:a+Q,value:a},{default:c(()=>[_(k(a),1)]),_:2},1032,["value"]))),128))]),_:1},8,["modelValue"])):$("",!0),e.value.inputType==="checkbox"?(u(),T(w,{key:2,modelValue:o.value.arr,"onUpdate:modelValue":i[5]||(i[5]=a=>o.value.arr=a)},{default:c(()=>[(u(!0),f(q,null,U(e.value.options,(a,Q)=>(u(),T(t,{key:a+Q,label:a},{default:c(()=>[_(k(a),1)]),_:2},1032,["label"]))),128))]),_:1},8,["modelValue"])):$("",!0)])])):$("",!0),d(P,{"is-creating":v.value,"create-text":"创建问题",onOnCancel:g,onOnConfirm:C,onOnCreate:E},null,8,["is-creating"])],2)}}}),xe=S(ke,[["__scopeId","data-v-c61a47f9"]]),qe={key:0},be={class:"questionnaire-item-list"},Ve=N({__name:"create-questionnaire",props:{newQuestionnaire:{}},emits:["on-add-config","on-remove-question","on-clear-new-question"],setup(n,{emit:l}){const r=b(""),e=b(!1),o=l,v=()=>{e.value=!0},V=()=>{e.value=!1,o("on-clear-new-question"),r.value=""},E=async()=>{if(n.newQuestionnaire.length<=0)return;if(!r.value){I({message:"请填写问卷标题",type:"warning"});return}const{data:C}=await O.post("/question/create_questionnaire",{config_fields:JSON.stringify(n.newQuestionnaire.map(g=>g.field)),title:r.value});C.config_fields.length&&o("on-add-config",{...C,config_fields:JSON.parse(C.config_fields)}),I({message:"创建问卷成功",type:"success"}),e.value=!1,o("on-clear-new-question"),r.value=""};return(C,g)=>{const D=J,i=K;return u(),f("div",{class:H(["create-question",{"is-creating":e.value}])},[e.value?(u(),f("div",qe,[g[1]||(g[1]=p("h3",null,"问卷标题",-1)),d(D,{modelValue:r.value,"onUpdate:modelValue":g[0]||(g[0]=x=>r.value=x)},null,8,["modelValue"]),g[2]||(g[2]=p("h3",null,"问题",-1)),p("div",be,[(u(!0),f(q,null,U(C.newQuestionnaire,x=>(u(),T(i,{key:x.field,closable:"",effect:"dark",type:"success",onClose:h=>C.$emit("on-remove-question",x)},{default:c(()=>[_(k(x.title),1)]),_:2},1032,["onClose"]))),128))])])):$("",!0),d(P,{"is-creating":e.value,"create-text":"创建问卷",onOnCancel:V,onOnConfirm:E,onOnCreate:v},null,8,["is-creating"])],2)}}}),Te=S(Ve,[["__scopeId","data-v-74955041"]]),Ie={class:"config-list-container"},Qe={class:"questionnaire-item-container"},$e={class:"questionnaire-item-list"},Ue={class:"create-questionnaire create-container"},Ee={class:"config-list"},Oe=["onClick"],De={class:"opts"},he=N({__name:"config-list",setup(n){const l=b(),r=b([]),e=b([]),o=b({configId:"",show:!1});ee(()=>{V(),v()});const v=async()=>{const{data:s}=await O.get("/question/get_questionnaire_item_list");l.value=s},V=async()=>{var t;const{data:s}=await O.get("/question/get_questionnaire_config");(t=s.custom_config_list)!=null&&t.length&&(r.value=s.custom_config_list.map(w=>({...w,config_fields:JSON.parse(w.config_fields)})))},E=s=>{ne.push({name:"questionnaire",query:{config_id:s,type:"check"}})},C=async()=>{o.value.show=!1;const s=r.value.findIndex(t=>t.id==o.value.configId);if(s>=0)r.value.splice(s,1);else{I({message:"删除问卷配置失败",type:"error"});return}await O.delete("/question/delete_questionnaire_config_by_id",{params:{config_id:o.value.configId}}),I({message:"删除问卷配置成功",type:"success"})},g=s=>{o.value.configId=s,o.value.show=!0},D=()=>{o.value.show=!1,o.value.configId=""},i=async s=>{try{const t=`${window.location.origin}/questionnaire/v1#questionnaire?config_id=${s}`;await navigator.clipboard.writeText(t),I({message:"复制链接成功",type:"success"})}catch(t){I({message:"复制链接失败",type:"error"}),console.error("Error copying text to clipboard:",t)}},x=s=>{if(e.value.find(w=>w.field==s.field)){I({message:"该问题项已添加",type:"warning"});return}e.value.push(s)},h=s=>{r.value.push(s)},R=s=>{const t=e.value.findIndex(w=>w.field==s.field);t>=0&&e.value.splice(t,1)},L=()=>{e.value=[]};return(s,t)=>{const w=re,a=K,Q=ce,M=j,X=de;return u(),f(q,null,[p("div",Ie,[d(Y,{"show-back-icon":!1,title:"问卷配置"}),p("div",Qe,[d(w,{style:{fontSize:"28px"}},{default:c(()=>t[1]||(t[1]=[_("问题项")])),_:1}),p("div",$e,[(u(!0),f(q,null,U(l.value,y=>(u(),T(a,{key:y.field,onClick:z=>x(y)},{default:c(()=>[_(k(y.title),1)]),_:2},1032,["onClick"]))),128))])]),p("div",Ue,[d(xe,{onOnConfirm:v}),d(Te,{"new-questionnaire":e.value,onOnAddConfig:h,onOnClearNewQuestion:L,onOnRemoveQuestion:R},null,8,["new-questionnaire"])]),p("div",Ee,[(u(!0),f(q,null,U(r.value,(y,z)=>(u(),f("div",{class:"config-item",key:y.id,underline:!1,onClick:A=>E(y.id)},[p("span",null,k(z+1)+"、"+k(y.title),1),p("div",De,[d(Q,{type:"primary",onClick:G(A=>i(y.id),["stop"])},{default:c(()=>t[2]||(t[2]=[_("复制链接")])),_:2},1032,["onClick"]),d(Q,{type:"danger",onClick:G(A=>g(y.id),["stop"])},{default:c(()=>t[3]||(t[3]=[_("删除")])),_:2},1032,["onClick"])])],8,Oe))),128))])]),d(X,{modelValue:o.value.show,"onUpdate:modelValue":t[0]||(t[0]=y=>o.value.show=y)},{header:c(()=>t[4]||(t[4]=[p("span",null,"删除",-1)])),footer:c(()=>[d(M,{type:"danger",onClick:C},{default:c(()=>t[5]||(t[5]=[_("确认")])),_:1}),d(M,{onClick:D},{default:c(()=>t[6]||(t[6]=[_("取消")])),_:1})]),default:c(()=>[t[7]||(t[7]=p("span",null,"确认删除该问卷配置",-1))]),_:1},8,["modelValue"])],64)}}}),Me=S(he,[["__scopeId","data-v-0bf03b19"]]);export{Me as default};

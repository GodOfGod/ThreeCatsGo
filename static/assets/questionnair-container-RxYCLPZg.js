var de=Object.defineProperty;var pe=(f,t,l)=>t in f?de(f,t,{enumerable:!0,configurable:!0,writable:!0,value:l}):f[t]=l;var Q=(f,t,l)=>pe(f,typeof t!="symbol"?t+"":t,l);import{_ as H}from"./logo-BaDEpkr8.js";import{x as K,az as ce,aA as me,c as z,ag as h,y as u,z as k,A as y,M as W,K as T,G as _,H as m,O as I,a4 as Y,P as g,L as V,T as fe,r as q,aB as ye,k as ve,C as ge,u as _e,aC as ke,E as xe}from"./common-DoM3tTau.js";import{_ as P,E as $,r as he}from"./index-CTVEOp0v.js";import{N as Te,i as M}from"./nav-bar-CzScn_om.js";const qe={class:"questionnaire-item"},Ve={class:"title-container"},we={class:"title-order"},Ce={class:"title-string"},be={key:0,class:"required-icon"},Re={class:"input-container"},Be={key:0,class:"remark-container"},Ne=K({__name:"questionnair-item",props:ce({order:{},field:{},title:{},required:{type:Boolean},inputType:{},needRemark:{type:Boolean},options:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(f){const t=me(f,"modelValue"),l=z(()=>JSON.parse(f.options)),d=z({get(){let a=[];try{a=JSON.parse(t.value)}catch(s){console.log(s),a=[]}return a},set(a){t.value=JSON.stringify(a)}});return(a,s)=>{const E=h("el-radio"),O=h("el-radio-group"),b=h("el-input"),D=h("el-checkbox"),J=h("el-checkbox-group"),L=h("el-text");return u(),k("div",qe,[y("div",Ve,[y("span",we,W(a.order)+"、",1),y("span",Ce,W(a.title),1),a.required?(u(),k("span",be,"*")):T("",!0)]),y("div",Re,[a.inputType==="radio"?(u(),_(O,{key:0,modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=p=>t.value=p)},{default:m(()=>[(u(!0),k(I,null,Y(l.value,p=>(u(),_(E,{key:p,value:p,label:p},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):a.inputType==="input"?(u(),_(b,{key:1,modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=p=>t.value=p)},null,8,["modelValue"])):a.inputType==="textarea"?(u(),_(b,{key:2,modelValue:t.value,"onUpdate:modelValue":s[2]||(s[2]=p=>t.value=p),type:"textarea",rows:4},null,8,["modelValue"])):a.inputType==="checkbox"?(u(),_(J,{key:3,modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=p=>d.value=p)},{default:m(()=>[(u(!0),k(I,null,Y(l.value,p=>(u(),_(D,{key:p,value:p,label:p},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):T("",!0)]),a.needRemark?(u(),k("div",Be,[g(L,{type:"info"},{default:m(()=>s[4]||(s[4]=[V("备注")])),_:1}),g(b,{type:"textarea"})])):T("",!0)])}}}),Se=P(Ne,[["__scopeId","data-v-8bff1c96"]]),Ue=[{field:"name",title:"宠物昵称",required:!0,inputType:"input",needRemark:!1},{field:"age",title:"宠物年龄",required:!0,inputType:"input",needRemark:!1},{field:"gender",title:"宠物性别",required:!0,inputType:"radio",needRemark:!1,options:["Boy","Girl"]},{field:"fertile",title:"是否绝育",required:!0,inputType:"radio",needRemark:!1,options:["纯原生","已噶"]},{field:"vaccine",title:"疫苗情况",required:!0,inputType:"input",needRemark:!1},{field:"health",title:"健康情况",required:!0,inputType:"input",needRemark:!1},{field:"personality",title:"性格",required:!0,inputType:"input",needRemark:!1},{field:"play",title:"是否需要陪玩",required:!0,inputType:"radio",needRemark:!1,options:["需要","不用啦"]},{field:"food",title:"食物偏好及食量",required:!0,inputType:"input",needRemark:!1},{field:"phone",title:"手机号",required:!0,inputType:"input",needRemark:!1}],$e=(f,t)=>{const l={},d=t.concat(Ue);return f.map(a=>{const s=d.find(E=>E.field===a);s&&(l[a]={value:"",title:s.title})}),l},Ee={key:0,class:"complete"},Le=K({__name:"complete-ending",props:{show:Boolean},setup(f){return(t,l)=>(u(),_(fe,null,{default:m(()=>[f.show?(u(),k("div",Ee,l[0]||(l[0]=[y("div",{class:"logo-container"},[y("img",{src:H,alt:""}),y("div",{class:"tip-text"},"提交成功")],-1)]))):T("",!0)]),_:1}))}}),Oe=P(Le,[["__scopeId","data-v-fc97dd25"]]);class j{constructor(t,l=1){Q(this,"ctx");Q(this,"dpr");this.ctx=t,this.dpr=l}moveTo(t,l){this.ctx.moveTo(t*this.dpr,l*this.dpr)}lineTo(t,l){this.ctx.lineTo(t*this.dpr,l*this.dpr)}arc(t,l,d,a,s){this.ctx.arc(t*this.dpr,l*this.dpr,d*this.dpr,a,s)}fillText(t,l,d){this.ctx.fillText(t,l*this.dpr,d*this.dpr)}}const De={class:"remark"},Je={class:"custom-title"},Me={class:"info-text"},Ge=K({__name:"questionnair-container",setup(f){const t=q({}),l=q(),d=ke(),a=q(""),s=q(""),E=q(!1),O=q([]),b=ye("containerRef"),D=q(""),J=q(!1),L=q(!1),p=z(()=>d.query.type==="edit"?"编辑":d.query.type==="check"?"查看":""),ee=z(()=>d.query?["edit","check"].includes(d.query.type):!1),R=z(()=>!!d.params.id),te=async(n="")=>{try{const{data:e}=await M.get("/question/get_questionnaire_config_by_id",{params:{config_id:n}}),r=JSON.parse(e.custom_config_fields);O.value=r.map(o=>{const c=e.questionnaire_item_list.find(v=>v.field===o);return{...c,inputType:c.input_type,needRemark:!1,required:!0}}),R.value||(t.value=$e(r,e.questionnaire_item_list))}catch(e){console.log(e)}},ne=async n=>{var e;try{const r=await M.get("/question/get_questionnaire_by_id",{params:{id:n}});l.value=r.data;const o=JSON.parse(((e=r.data)==null?void 0:e.questionnaire)??JSON.stringify({}));t.value=o,a.value=(o==null?void 0:o.remark)??"",s.value=(o==null?void 0:o.main_title)??""}catch(r){console.error("Error fetching order info:",r)}};ve(async()=>{const n=d.params;n.id&&await ne(n.id),D.value=d.query.config_id??"",await te(d.query.config_id),E.value=!0});const oe=async()=>{if(!D.value){$({message:"啊哦～出现了一些问题",type:"error"});return}try{R.value?await ae():(J.value=!0,await le())}catch(n){console.log(n)}},le=async()=>{try{await M.post("/question/submit_questionnaire",{questionnaire:JSON.stringify(t.value),date:new Date().toLocaleDateString(),config_id:D.value}),$({message:"提交成功",type:"success",offset:100})}catch(n){console.log(n),$({message:"提交失败，请直接联系我",type:"error",offset:100})}},ae=async()=>{var n;try{await M.post("/question/update_questionnaire",{id:d.params.id,questionnaire:JSON.stringify({...t.value,remark:a.value,main_title:s.value}),date:(n=l.value)==null?void 0:n.date}),$({message:"修改成功",type:"success",offset:100})}catch(e){console.log(e),$({message:"修改失败，请直接联系我",type:"error",offset:100})}},ie=async()=>{L.value=!0},se=async()=>{try{await M.delete("/question/delete_questionnaire_by_id",{params:{id:d.params.id}}),$({message:"删除成功",type:"success",offset:100}),he.push({name:"manage-home"})}catch(n){console.log(n),$({message:"删除失败，请直接联系我",type:"error",offset:100})}},re=async()=>{var F;const n=document.createElement("canvas"),e=(F=b.value)==null?void 0:F.getBoundingClientRect(),r=((e==null?void 0:e.width)??600)+40,o=((e==null?void 0:e.height)??600)-200,c=window.devicePixelRatio||1;n.width=r*c,n.height=o*c,n.style.width=`${r}px`,n.style.height=`${o}px`,n.style.backgroundColor="#fff";const v=n.getContext("2d"),i={originX:30,originY:30,x:30,y:30},B=10,w=20,x=110;if(v){v.fillStyle="black",O.value.forEach(G=>{const{title:U,value:ue}=t.value[G.field];Z({value:ue,title:U},v,i,w,n,x,B)}),a.value&&Z({value:a.value,title:"备注"},v,i,w,n,x,B);const N={x:i.originX-8,y:i.originY-9},S={x:i.originX-8,y:i.y},X={x:i.originX-8+n.width/c-50,y:i.originY-9},A={x:i.x-8+n.width/c-50,y:i.y},C=new j(v,c);v.beginPath(),C.moveTo(N.x,N.y),C.lineTo(S.x,i.y),C.moveTo(N.x+x,N.y),C.lineTo(S.x+x,S.y),C.moveTo(X.x,X.y),C.lineTo(A.x,A.y),C.moveTo(S.x,S.y),C.lineTo(A.x,A.y),v.stroke(),n.toBlob(G=>{const U=document.createElement("a");U.href=URL.createObjectURL(G),U.download=`${t.value.address.value}-${t.value.name.value}.png`,document.body.appendChild(U),U.click(),U.remove()})}},Z=({value:n,title:e},r,o,c,v,i=80,B=10)=>{const w=window.devicePixelRatio||1,x=new j(r,w);if(o.y+=B,r.beginPath(),r.lineWidth=.5,x.moveTo(o.x-8,o.y-c),x.lineTo(o.x-8+v.width/w-50,o.y-c),r.stroke(),r.font=`${12*w}px Arial`,x.fillText(e,o.x,o.y),n.length>20){const N=n.match(/.{1,20}/g);N.forEach((S,X)=>{x.fillText(S,o.x+i,o.y+X*c)}),o.y=o.y+N.length*c}else x.fillText(n,o.x+i,o.y),o.y+=c};return(n,e)=>{const r=h("el-button"),o=h("el-text"),c=h("el-input"),v=h("el-dialog");return u(),k(I,null,[g(Oe,{show:J.value},null,8,["show"]),J.value?T("",!0):(u(),k("div",{key:0,class:"scroll-container",ref_key:"containerRef",ref:b},[E.value?(u(),k("div",{key:0,class:ge(["questionnaire-container",{"is-modifying":R.value}])},[ee.value?(u(),_(Te,{key:0,title:p.value,scrollerRef:_e(b)},{right:m(()=>[R.value?(u(),_(r,{key:0,style:{width:"70px"},type:"primary",onClick:re},{default:m(()=>e[4]||(e[4]=[V("下载")])),_:1})):T("",!0)]),_:1},8,["title","scrollerRef"])):T("",!0),e[9]||(e[9]=y("img",{class:"logo",src:H,alt:""},null,-1)),e[10]||(e[10]=y("div",{class:"main-title"},"上门喂养信息收集",-1)),(u(!0),k(I,null,Y(O.value,(i,B)=>(u(),_(Se,xe({order:B+1,key:B,ref_for:!0},i,{modelValue:t.value[i.field].value,"onUpdate:modelValue":w=>t.value[i.field].value=w}),null,16,["order","modelValue","onUpdate:modelValue"]))),128)),R.value?(u(),k(I,{key:1},[y("div",De,[g(o,{type:"danger",style:{fontSize:"28px"}},{default:m(()=>e[5]||(e[5]=[V("备注")])),_:1}),g(c,{type:"textarea",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=i=>a.value=i),autosize:{minRows:5}},null,8,["modelValue"])]),y("div",Je,[g(o,{type:"danger",style:{fontSize:"28px"}},{default:m(()=>e[6]||(e[6]=[V("标题")])),_:1}),g(c,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=i=>s.value=i)},null,8,["modelValue"])])],64)):T("",!0),g(r,{class:"submit-btn",type:"primary",onClick:oe},{default:m(()=>[V(W(R.value?"修改":"交给你啦"),1)]),_:1}),R.value?(u(),_(r,{key:2,class:"submit-btn",type:"danger",onClick:ie},{default:m(()=>e[7]||(e[7]=[V("删除")])),_:1})):T("",!0),y("div",Me,[g(o,{type:"info"},{default:m(()=>e[8]||(e[8]=[V("我们将严格保密您的信息，仅用于服务安排。")])),_:1})])],2)):T("",!0)],512)),g(v,{modelValue:L.value,"onUpdate:modelValue":e[3]||(e[3]=i=>L.value=i)},{header:m(()=>e[11]||(e[11]=[y("span",null,"删除",-1)])),footer:m(()=>[g(r,{type:"primary",onClick:se},{default:m(()=>e[12]||(e[12]=[V("确认")])),_:1}),g(r,{onClick:e[2]||(e[2]=i=>L.value=!1)},{default:m(()=>e[13]||(e[13]=[V("取消")])),_:1})]),default:m(()=>[e[14]||(e[14]=y("span",null,"确认删除该问卷",-1))]),_:1},8,["modelValue"])],64)}}});export{Ge as default};

import{_ as I}from"./logo-BaDEpkr8.js";import{g as $,m as X,u as Y,h as B,r as v,o as n,c as f,j as u,t as M,k as g,l as k,w as r,F as U,n as O,a as p,p as q,T as Z,q as _,s as j,v as ee,x as te,y as ne,z as oe,A as T,B as ae}from"./common-5WyZeT9A.js";import{_ as E,r as le}from"./index-C2Dnz2iB.js";import{N as se,i as S}from"./nav-bar-BUb4WQVa.js";const ie={class:"questionnaire-item"},re={class:"title-container"},ue={class:"title-order"},de={class:"title-string"},pe={key:0,class:"required-icon"},ce={class:"input-container"},me={key:0,class:"remark-container"},fe=$({__name:"questionnair-item",props:X({order:{},field:{},title:{},required:{type:Boolean},inputType:{},needRemark:{type:Boolean},options:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(V){const a=Y(V,"modelValue"),c=B(()=>JSON.parse(V.options)),s=B({get(){let t=[];try{t=JSON.parse(a.value)}catch(o){console.log(o),t=[]}return t},set(t){a.value=JSON.stringify(t)}});return(t,o)=>{const b=v("el-radio"),J=v("el-radio-group"),x=v("el-input"),N=v("el-checkbox"),h=v("el-checkbox-group"),w=v("el-text");return n(),f("div",ie,[u("div",re,[u("span",ue,M(t.order)+"、",1),u("span",de,M(t.title),1),t.required?(n(),f("span",pe,"*")):g("",!0)]),u("div",ce,[t.inputType==="radio"?(n(),k(J,{key:0,modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=i=>a.value=i)},{default:r(()=>[(n(!0),f(U,null,O(c.value,i=>(n(),k(b,{key:i,value:i,label:i},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):t.inputType==="input"?(n(),k(x,{key:1,modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=i=>a.value=i)},null,8,["modelValue"])):t.inputType==="checkbox"?(n(),k(h,{key:2,modelValue:s.value,"onUpdate:modelValue":o[2]||(o[2]=i=>s.value=i)},{default:r(()=>[(n(!0),f(U,null,O(c.value,i=>(n(),k(N,{key:i,value:i,label:i},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):g("",!0)]),t.needRemark?(n(),f("div",me,[p(w,{type:"info"},{default:r(()=>o[3]||(o[3]=[q("备注")])),_:1}),p(x,{type:"textarea"})])):g("",!0)])}}}),ye=E(fe,[["__scopeId","data-v-625eac44"]]),ve=[{field:"name",title:"宠物昵称",required:!0,inputType:"input",needRemark:!1},{field:"age",title:"宠物年龄",required:!0,inputType:"input",needRemark:!1},{field:"gender",title:"宠物性别",required:!0,inputType:"radio",needRemark:!1,options:["Boy","Girl"]},{field:"fertile",title:"是否绝育",required:!0,inputType:"radio",needRemark:!1,options:["纯原生","已噶"]},{field:"vaccine",title:"疫苗情况",required:!0,inputType:"input",needRemark:!1},{field:"health",title:"健康情况",required:!0,inputType:"input",needRemark:!1},{field:"personality",title:"性格",required:!0,inputType:"input",needRemark:!1},{field:"play",title:"是否需要陪玩",required:!0,inputType:"radio",needRemark:!1,options:["需要","不用啦"]},{field:"food",title:"食物偏好及食量",required:!0,inputType:"input",needRemark:!1},{field:"phone",title:"手机号",required:!0,inputType:"input",needRemark:!1}],_e=(V,a)=>{const c={},s=a.concat(ve);return V.map(t=>{const o=s.find(b=>b.field===t);o&&(c[t]={value:"",title:o.title})}),c},ge={key:0,class:"complete"},ke=$({__name:"complete-ending",props:{show:Boolean},setup(V){return(a,c)=>(n(),k(Z,null,{default:r(()=>[V.show?(n(),f("div",ge,c[0]||(c[0]=[u("div",{class:"logo-container"},[u("img",{src:I,alt:""}),u("div",{class:"tip-text"},"提交成功")],-1)]))):g("",!0)]),_:1}))}}),qe=E(ke,[["__scopeId","data-v-fc97dd25"]]),Ve={class:"remark"},Re={class:"custom-title"},Te={class:"info-text"},Ne=$({__name:"questionnair-container",setup(V){const a=_({}),c=_(),s=oe(),t=_(""),o=_(""),b=_(!1),J=_([]),x=j("containerRef"),N=_(""),h=_(!1),w=_(!1),i=B(()=>s.query.type==="edit"?"编辑":s.query.type==="check"?"查看":""),F=B(()=>s.query?["edit","check"].includes(s.query.type):!1),C=B(()=>!!s.params.id),L=async(l="")=>{try{const{data:e}=await S.get("/question/get_questionnaire_config_by_id",{params:{config_id:l}}),m=JSON.parse(e.custom_config_fields);J.value=m.map(d=>{const R=e.questionnaire_item_list.find(D=>D.field===d);return{...R,inputType:R.input_type,needRemark:!1,required:!0}}),C.value||(a.value=_e(m,e.questionnaire_item_list))}catch(e){console.log(e)}},Q=async l=>{var e;try{const m=await S.get("/question/get_questionnaire_by_id",{params:{id:l}});c.value=m.data;const d=JSON.parse(((e=m.data)==null?void 0:e.questionnaire)??JSON.stringify({}));a.value=d,t.value=(d==null?void 0:d.remark)??"",o.value=(d==null?void 0:d.main_title)??""}catch(m){console.error("Error fetching order info:",m)}};ee(async()=>{const l=s.params;l.id&&await Q(l.id),N.value=s.query.config_id??"",await L(s.query.config_id),b.value=!0});const A=async()=>{if(!N.value){T({message:"啊哦～出现了一些问题",type:"error"});return}try{C.value?await P():(h.value=!0,await G())}catch(l){console.log(l)}},G=async()=>{try{await S.post("/question/submit_questionnaire",{questionnaire:JSON.stringify(a.value),date:new Date().toLocaleDateString(),config_id:N.value}),T({message:"提交成功",type:"success",offset:100})}catch(l){console.log(l),T({message:"提交失败，请直接联系我",type:"error",offset:100})}},P=async()=>{var l;try{await S.post("/question/update_questionnaire",{id:s.params.id,questionnaire:JSON.stringify({...a.value,remark:t.value,main_title:o.value}),date:(l=c.value)==null?void 0:l.date}),T({message:"修改成功",type:"success",offset:100})}catch(e){console.log(e),T({message:"修改失败，请直接联系我",type:"error",offset:100})}},H=async()=>{w.value=!0},K=async()=>{try{await S.delete("/question/delete_questionnaire_by_id",{params:{id:s.params.id}}),T({message:"删除成功",type:"success",offset:100}),le.push({name:"manage-home"})}catch(l){console.log(l),T({message:"删除失败，请直接联系我",type:"error",offset:100})}};return(l,e)=>{const m=v("el-text"),d=v("el-input"),R=v("el-button"),D=v("el-dialog");return n(),f(U,null,[p(qe,{show:h.value},null,8,["show"]),h.value?g("",!0):(n(),f("div",{key:0,class:"scroll-container",ref_key:"containerRef",ref:x},[b.value?(n(),f("div",{key:0,class:te(["questionnaire-container",{"is-modifying":C.value}])},[F.value?(n(),k(se,{key:0,title:i.value,scrollerRef:ne(x)},null,8,["title","scrollerRef"])):g("",!0),e[8]||(e[8]=u("img",{class:"logo",src:I,alt:""},null,-1)),e[9]||(e[9]=u("div",{class:"main-title"},"上门喂养信息收集",-1)),(n(!0),f(U,null,O(J.value,(y,z)=>(n(),k(ye,ae({order:z+1,key:z,ref_for:!0},y,{modelValue:a.value[y.field].value,"onUpdate:modelValue":W=>a.value[y.field].value=W}),null,16,["order","modelValue","onUpdate:modelValue"]))),128)),C.value?(n(),f(U,{key:1},[u("div",Ve,[p(m,{type:"danger",style:{fontSize:"28px"}},{default:r(()=>e[4]||(e[4]=[q("备注")])),_:1}),p(d,{type:"textarea",modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=y=>t.value=y),autosize:{minRows:5}},null,8,["modelValue"])]),u("div",Re,[p(m,{type:"danger",style:{fontSize:"28px"}},{default:r(()=>e[5]||(e[5]=[q("标题")])),_:1}),p(d,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=y=>o.value=y)},null,8,["modelValue"])])],64)):g("",!0),p(R,{class:"submit-btn",type:"primary",onClick:A},{default:r(()=>[q(M(C.value?"修改":"交给你啦"),1)]),_:1}),C.value?(n(),k(R,{key:2,class:"submit-btn",type:"danger",onClick:H},{default:r(()=>e[6]||(e[6]=[q("删除")])),_:1})):g("",!0),u("div",Te,[p(m,{type:"info"},{default:r(()=>e[7]||(e[7]=[q("我们将严格保密您的信息，仅用于服务安排。")])),_:1})])],2)):g("",!0)],512)),p(D,{modelValue:w.value,"onUpdate:modelValue":e[3]||(e[3]=y=>w.value=y)},{header:r(()=>e[10]||(e[10]=[u("span",null,"删除",-1)])),footer:r(()=>[p(R,{type:"primary",onClick:K},{default:r(()=>e[11]||(e[11]=[q("确认")])),_:1}),p(R,{onClick:e[2]||(e[2]=y=>w.value=!1)},{default:r(()=>e[12]||(e[12]=[q("取消")])),_:1})]),default:r(()=>[e[13]||(e[13]=u("span",null,"确认删除该问卷",-1))]),_:1},8,["modelValue"])],64)}}});export{Ne as default};

import{_ as I}from"./logo-BaDEpkr8.js";import{g as $,m as X,u as Y,h as B,r as v,o as n,c,j as u,t as M,k,l as _,w as r,F as U,n as O,a as p,p as q,T as Z,q as g,s as j,v as ee,x as te,y as ne,z as oe,A as R,B as ae}from"./common-5WyZeT9A.js";import{_ as E,r as le}from"./index-BvZTORtu.js";import{N as se,i as h}from"./nav-bar-CmhLYw_P.js";const ie={class:"questionnaire-item"},re={class:"title-container"},ue={class:"title-order"},de={class:"title-string"},pe={key:0,class:"required-icon"},me={class:"input-container"},fe={key:0,class:"remark-container"},ce=$({__name:"questionnair-item",props:X({order:{},field:{},title:{},required:{type:Boolean},inputType:{},needRemark:{type:Boolean},options:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(V){const a=Y(V,"modelValue"),m=B(()=>JSON.parse(V.options)),i=B({get(){let t=[];try{t=JSON.parse(a.value)}catch(o){console.log(o),t=[]}return t},set(t){a.value=JSON.stringify(t)}});return(t,o)=>{const w=v("el-radio"),J=v("el-radio-group"),b=v("el-input"),N=v("el-checkbox"),S=v("el-checkbox-group"),C=v("el-text");return n(),c("div",ie,[u("div",re,[u("span",ue,M(t.order)+"、",1),u("span",de,M(t.title),1),t.required?(n(),c("span",pe,"*")):k("",!0)]),u("div",me,[t.inputType==="radio"?(n(),_(J,{key:0,modelValue:a.value,"onUpdate:modelValue":o[0]||(o[0]=l=>a.value=l)},{default:r(()=>[(n(!0),c(U,null,O(m.value,l=>(n(),_(w,{key:l,value:l,label:l},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):t.inputType==="input"?(n(),_(b,{key:1,modelValue:a.value,"onUpdate:modelValue":o[1]||(o[1]=l=>a.value=l)},null,8,["modelValue"])):t.inputType==="textarea"?(n(),_(b,{key:2,modelValue:a.value,"onUpdate:modelValue":o[2]||(o[2]=l=>a.value=l),type:"textarea",rows:4},null,8,["modelValue"])):t.inputType==="checkbox"?(n(),_(S,{key:3,modelValue:i.value,"onUpdate:modelValue":o[3]||(o[3]=l=>i.value=l)},{default:r(()=>[(n(!0),c(U,null,O(m.value,l=>(n(),_(N,{key:l,value:l,label:l},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):k("",!0)]),t.needRemark?(n(),c("div",fe,[p(C,{type:"info"},{default:r(()=>o[4]||(o[4]=[q("备注")])),_:1}),p(b,{type:"textarea"})])):k("",!0)])}}}),ye=E(ce,[["__scopeId","data-v-cf1f345a"]]),ve=[{field:"name",title:"宠物昵称",required:!0,inputType:"input",needRemark:!1},{field:"age",title:"宠物年龄",required:!0,inputType:"input",needRemark:!1},{field:"gender",title:"宠物性别",required:!0,inputType:"radio",needRemark:!1,options:["Boy","Girl"]},{field:"fertile",title:"是否绝育",required:!0,inputType:"radio",needRemark:!1,options:["纯原生","已噶"]},{field:"vaccine",title:"疫苗情况",required:!0,inputType:"input",needRemark:!1},{field:"health",title:"健康情况",required:!0,inputType:"input",needRemark:!1},{field:"personality",title:"性格",required:!0,inputType:"input",needRemark:!1},{field:"play",title:"是否需要陪玩",required:!0,inputType:"radio",needRemark:!1,options:["需要","不用啦"]},{field:"food",title:"食物偏好及食量",required:!0,inputType:"input",needRemark:!1},{field:"phone",title:"手机号",required:!0,inputType:"input",needRemark:!1}],_e=(V,a)=>{const m={},i=a.concat(ve);return V.map(t=>{const o=i.find(w=>w.field===t);o&&(m[t]={value:"",title:o.title})}),m},ge={key:0,class:"complete"},ke=$({__name:"complete-ending",props:{show:Boolean},setup(V){return(a,m)=>(n(),_(Z,null,{default:r(()=>[V.show?(n(),c("div",ge,m[0]||(m[0]=[u("div",{class:"logo-container"},[u("img",{src:I,alt:""}),u("div",{class:"tip-text"},"提交成功")],-1)]))):k("",!0)]),_:1}))}}),qe=E(ke,[["__scopeId","data-v-fc97dd25"]]),Ve={class:"remark"},Te={class:"custom-title"},Re={class:"info-text"},Ne=$({__name:"questionnair-container",setup(V){const a=g({}),m=g(),i=oe(),t=g(""),o=g(""),w=g(!1),J=g([]),b=j("containerRef"),N=g(""),S=g(!1),C=g(!1),l=B(()=>i.query.type==="edit"?"编辑":i.query.type==="check"?"查看":""),F=B(()=>i.query?["edit","check"].includes(i.query.type):!1),x=B(()=>!!i.params.id),L=async(s="")=>{try{const{data:e}=await h.get("/question/get_questionnaire_config_by_id",{params:{config_id:s}}),f=JSON.parse(e.custom_config_fields);J.value=f.map(d=>{const T=e.questionnaire_item_list.find(D=>D.field===d);return{...T,inputType:T.input_type,needRemark:!1,required:!0}}),x.value||(a.value=_e(f,e.questionnaire_item_list))}catch(e){console.log(e)}},Q=async s=>{var e;try{const f=await h.get("/question/get_questionnaire_by_id",{params:{id:s}});m.value=f.data;const d=JSON.parse(((e=f.data)==null?void 0:e.questionnaire)??JSON.stringify({}));a.value=d,t.value=(d==null?void 0:d.remark)??"",o.value=(d==null?void 0:d.main_title)??""}catch(f){console.error("Error fetching order info:",f)}};ee(async()=>{const s=i.params;s.id&&await Q(s.id),N.value=i.query.config_id??"",await L(i.query.config_id),w.value=!0});const A=async()=>{if(!N.value){R({message:"啊哦～出现了一些问题",type:"error"});return}try{x.value?await P():(S.value=!0,await G())}catch(s){console.log(s)}},G=async()=>{try{await h.post("/question/submit_questionnaire",{questionnaire:JSON.stringify(a.value),date:new Date().toLocaleDateString(),config_id:N.value}),R({message:"提交成功",type:"success",offset:100})}catch(s){console.log(s),R({message:"提交失败，请直接联系我",type:"error",offset:100})}},P=async()=>{var s;try{await h.post("/question/update_questionnaire",{id:i.params.id,questionnaire:JSON.stringify({...a.value,remark:t.value,main_title:o.value}),date:(s=m.value)==null?void 0:s.date}),R({message:"修改成功",type:"success",offset:100})}catch(e){console.log(e),R({message:"修改失败，请直接联系我",type:"error",offset:100})}},H=async()=>{C.value=!0},K=async()=>{try{await h.delete("/question/delete_questionnaire_by_id",{params:{id:i.params.id}}),R({message:"删除成功",type:"success",offset:100}),le.push({name:"manage-home"})}catch(s){console.log(s),R({message:"删除失败，请直接联系我",type:"error",offset:100})}};return(s,e)=>{const f=v("el-text"),d=v("el-input"),T=v("el-button"),D=v("el-dialog");return n(),c(U,null,[p(qe,{show:S.value},null,8,["show"]),S.value?k("",!0):(n(),c("div",{key:0,class:"scroll-container",ref_key:"containerRef",ref:b},[w.value?(n(),c("div",{key:0,class:te(["questionnaire-container",{"is-modifying":x.value}])},[F.value?(n(),_(se,{key:0,title:l.value,scrollerRef:ne(b)},null,8,["title","scrollerRef"])):k("",!0),e[8]||(e[8]=u("img",{class:"logo",src:I,alt:""},null,-1)),e[9]||(e[9]=u("div",{class:"main-title"},"上门喂养信息收集",-1)),(n(!0),c(U,null,O(J.value,(y,z)=>(n(),_(ye,ae({order:z+1,key:z,ref_for:!0},y,{modelValue:a.value[y.field].value,"onUpdate:modelValue":W=>a.value[y.field].value=W}),null,16,["order","modelValue","onUpdate:modelValue"]))),128)),x.value?(n(),c(U,{key:1},[u("div",Ve,[p(f,{type:"danger",style:{fontSize:"28px"}},{default:r(()=>e[4]||(e[4]=[q("备注")])),_:1}),p(d,{type:"textarea",modelValue:t.value,"onUpdate:modelValue":e[0]||(e[0]=y=>t.value=y),autosize:{minRows:5}},null,8,["modelValue"])]),u("div",Te,[p(f,{type:"danger",style:{fontSize:"28px"}},{default:r(()=>e[5]||(e[5]=[q("标题")])),_:1}),p(d,{modelValue:o.value,"onUpdate:modelValue":e[1]||(e[1]=y=>o.value=y)},null,8,["modelValue"])])],64)):k("",!0),p(T,{class:"submit-btn",type:"primary",onClick:A},{default:r(()=>[q(M(x.value?"修改":"交给你啦"),1)]),_:1}),x.value?(n(),_(T,{key:2,class:"submit-btn",type:"danger",onClick:H},{default:r(()=>e[6]||(e[6]=[q("删除")])),_:1})):k("",!0),u("div",Re,[p(f,{type:"info"},{default:r(()=>e[7]||(e[7]=[q("我们将严格保密您的信息，仅用于服务安排。")])),_:1})])],2)):k("",!0)],512)),p(D,{modelValue:C.value,"onUpdate:modelValue":e[3]||(e[3]=y=>C.value=y)},{header:r(()=>e[10]||(e[10]=[u("span",null,"删除",-1)])),footer:r(()=>[p(T,{type:"primary",onClick:K},{default:r(()=>e[11]||(e[11]=[q("确认")])),_:1}),p(T,{onClick:e[2]||(e[2]=y=>C.value=!1)},{default:r(()=>e[12]||(e[12]=[q("取消")])),_:1})]),default:r(()=>[e[13]||(e[13]=u("span",null,"确认删除该问卷",-1))]),_:1},8,["modelValue"])],64)}}});export{Ne as default};

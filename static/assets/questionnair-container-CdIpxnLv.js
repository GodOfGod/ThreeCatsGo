var ce=Object.defineProperty;var me=(y,t,i)=>t in y?ce(y,t,{enumerable:!0,configurable:!0,writable:!0,value:i}):y[t]=i;var G=(y,t,i)=>me(y,typeof t!="symbol"?t+"":t,i);import{_ as H}from"./logo-BaDEpkr8.js";import{x as Y,az as fe,aA as ye,c as M,ag as T,y as u,z as x,A as f,M as Q,K as q,G as k,H as c,O as I,a4 as W,P as g,L as V,T as ve,r as _,aB as ge,k as _e,C as ke,u as xe,aC as he,E as Te}from"./common-DoM3tTau.js";import{_ as P,E as U,r as qe}from"./index-CXUmDKpN.js";import{N as Ve,i as J}from"./nav-bar-Dm-95pbl.js";const we={class:"questionnaire-item"},Ce={class:"title-container"},be={class:"title-order"},Re={class:"title-string"},Be={key:0,class:"required-icon"},Ne={class:"input-container"},Se={key:0,class:"remark-container"},Ue=Y({__name:"questionnair-item",props:fe({order:{},field:{},title:{},required:{type:Boolean},inputType:{},needRemark:{type:Boolean},options:{}},{modelValue:{},modelModifiers:{}}),emits:["update:modelValue"],setup(y){const t=ye(y,"modelValue"),i=M(()=>JSON.parse(y.options)),d=M({get(){let a=[];try{a=JSON.parse(t.value)}catch(s){console.log(s),a=[]}return a},set(a){t.value=JSON.stringify(a)}});return(a,s)=>{const $=T("el-radio"),L=T("el-radio-group"),b=T("el-input"),O=T("el-checkbox"),D=T("el-checkbox-group"),E=T("el-text");return u(),x("div",we,[f("div",Ce,[f("span",be,Q(a.order)+"、",1),f("span",Re,Q(a.title),1),a.required?(u(),x("span",Be,"*")):q("",!0)]),f("div",Ne,[a.inputType==="radio"?(u(),k(L,{key:0,modelValue:t.value,"onUpdate:modelValue":s[0]||(s[0]=p=>t.value=p)},{default:c(()=>[(u(!0),x(I,null,W(i.value,p=>(u(),k($,{key:p,value:p,label:p},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):a.inputType==="input"?(u(),k(b,{key:1,modelValue:t.value,"onUpdate:modelValue":s[1]||(s[1]=p=>t.value=p)},null,8,["modelValue"])):a.inputType==="textarea"?(u(),k(b,{key:2,modelValue:t.value,"onUpdate:modelValue":s[2]||(s[2]=p=>t.value=p),type:"textarea",rows:4},null,8,["modelValue"])):a.inputType==="checkbox"?(u(),k(D,{key:3,modelValue:d.value,"onUpdate:modelValue":s[3]||(s[3]=p=>d.value=p)},{default:c(()=>[(u(!0),x(I,null,W(i.value,p=>(u(),k(O,{key:p,value:p,label:p},null,8,["value","label"]))),128))]),_:1},8,["modelValue"])):q("",!0)]),a.needRemark?(u(),x("div",Se,[g(E,{type:"info"},{default:c(()=>s[4]||(s[4]=[V("备注")])),_:1}),g(b,{type:"textarea"})])):q("",!0)])}}}),$e=P(Ue,[["__scopeId","data-v-8bff1c96"]]),Ee=[{field:"name",title:"宠物昵称",required:!0,inputType:"input",needRemark:!1},{field:"age",title:"宠物年龄",required:!0,inputType:"input",needRemark:!1},{field:"gender",title:"宠物性别",required:!0,inputType:"radio",needRemark:!1,options:["Boy","Girl"]},{field:"fertile",title:"是否绝育",required:!0,inputType:"radio",needRemark:!1,options:["纯原生","已噶"]},{field:"vaccine",title:"疫苗情况",required:!0,inputType:"input",needRemark:!1},{field:"health",title:"健康情况",required:!0,inputType:"input",needRemark:!1},{field:"personality",title:"性格",required:!0,inputType:"input",needRemark:!1},{field:"play",title:"是否需要陪玩",required:!0,inputType:"radio",needRemark:!1,options:["需要","不用啦"]},{field:"food",title:"食物偏好及食量",required:!0,inputType:"input",needRemark:!1},{field:"phone",title:"手机号",required:!0,inputType:"input",needRemark:!1}],Le=(y,t)=>{const i={},d=t.concat(Ee);return y.map(a=>{const s=d.find($=>$.field===a);s&&(i[a]={value:"",title:s.title})}),i},Oe={key:0,class:"complete"},De=Y({__name:"complete-ending",props:{show:Boolean},setup(y){return(t,i)=>(u(),k(ve,null,{default:c(()=>[y.show?(u(),x("div",Oe,i[0]||(i[0]=[f("div",{class:"logo-container"},[f("img",{src:H,alt:""}),f("div",{class:"tip-text"},"提交成功")],-1)]))):q("",!0)]),_:1}))}}),Je=P(De,[["__scopeId","data-v-fc97dd25"]]);class j{constructor(t,i=1){G(this,"ctx");G(this,"dpr");this.ctx=t,this.dpr=i}moveTo(t,i){this.ctx.moveTo(t*this.dpr,i*this.dpr)}lineTo(t,i){this.ctx.lineTo(t*this.dpr,i*this.dpr)}arc(t,i,d,a,s){this.ctx.arc(t*this.dpr,i*this.dpr,d*this.dpr,a,s)}fillText(t,i,d){this.ctx.fillText(t,i*this.dpr,d*this.dpr)}}const Me={class:"remark"},Ie={class:"custom-title"},ze={class:"info-text"},Xe=["src"],Ye=Y({__name:"questionnair-container",setup(y){const t=_({}),i=_(),d=he(),a=_(""),s=_(""),$=_(!1),L=_([]),b=ge("containerRef"),O=_(""),D=_(!1),E=_(!1),p=_(!1),K=_(""),ee=M(()=>d.query.type==="edit"?"编辑":d.query.type==="check"?"查看":""),te=M(()=>d.query?["edit","check"].includes(d.query.type):!1),R=M(()=>!!d.params.id),oe=async(o="")=>{try{const{data:e}=await J.get("/question/get_questionnaire_config_by_id",{params:{config_id:o}}),r=JSON.parse(e.custom_config_fields);L.value=r.map(n=>{const m=e.questionnaire_item_list.find(v=>v.field===n);return{...m,inputType:m.input_type,needRemark:!1,required:!0}}),R.value||(t.value=Le(r,e.questionnaire_item_list))}catch(e){console.log(e)}},ne=async o=>{var e;try{const r=await J.get("/question/get_questionnaire_by_id",{params:{id:o}});i.value=r.data;const n=JSON.parse(((e=r.data)==null?void 0:e.questionnaire)??JSON.stringify({}));t.value=n,a.value=(n==null?void 0:n.remark)??"",s.value=(n==null?void 0:n.main_title)??""}catch(r){console.error("Error fetching order info:",r)}};_e(async()=>{const o=d.params;o.id&&await ne(o.id),O.value=d.query.config_id??"",await oe(d.query.config_id),$.value=!0});const le=async()=>{if(!O.value){U({message:"啊哦～出现了一些问题",type:"error"});return}try{R.value?await ae():(D.value=!0,await ie())}catch(o){console.log(o)}},ie=async()=>{try{await J.post("/question/submit_questionnaire",{questionnaire:JSON.stringify(t.value),date:new Date().toLocaleDateString(),config_id:O.value}),U({message:"提交成功",type:"success",offset:100})}catch(o){console.log(o),U({message:"提交失败，请直接联系我",type:"error",offset:100})}},ae=async()=>{var o;try{await J.post("/question/update_questionnaire",{id:d.params.id,questionnaire:JSON.stringify({...t.value,remark:a.value,main_title:s.value}),date:(o=i.value)==null?void 0:o.date}),U({message:"修改成功",type:"success",offset:100})}catch(e){console.log(e),U({message:"修改失败，请直接联系我",type:"error",offset:100})}},se=async()=>{E.value=!0},re=async()=>{try{await J.delete("/question/delete_questionnaire_by_id",{params:{id:d.params.id}}),U({message:"删除成功",type:"success",offset:100}),qe.push({name:"manage-home"})}catch(o){console.log(o),U({message:"删除失败，请直接联系我",type:"error",offset:100})}},ue=async()=>{var A;const o=document.createElement("canvas"),e=(A=b.value)==null?void 0:A.getBoundingClientRect(),r=((e==null?void 0:e.width)??600)+40,n=((e==null?void 0:e.height)??600)-200,m=window.devicePixelRatio||1;o.width=r*m,o.height=n*m,o.style.width=`${r}px`,o.style.height=`${n}px`,o.style.backgroundColor="#fff";const v=o.getContext("2d"),l={originX:30,originY:30,x:30,y:30},B=10,w=20,h=110;if(v){v.fillStyle="black",L.value.forEach(F=>{const{title:de,value:pe}=t.value[F.field];Z({value:pe,title:de},v,l,w,o,h,B)}),a.value&&Z({value:a.value,title:"备注"},v,l,w,o,h,B);const N={x:l.originX-8,y:l.originY-9},S={x:l.originX-8,y:l.y},z={x:l.originX-8+o.width/m-50,y:l.originY-9},X={x:l.x-8+o.width/m-50,y:l.y},C=new j(v,m);v.beginPath(),C.moveTo(N.x,N.y),C.lineTo(S.x,l.y),C.moveTo(N.x+h,N.y),C.lineTo(S.x+h,S.y),C.moveTo(z.x,z.y),C.lineTo(X.x,X.y),C.moveTo(S.x,S.y),C.lineTo(X.x,X.y),v.stroke(),o.toBlob(F=>{K.value=URL.createObjectURL(F),p.value=!0})}},Z=({value:o,title:e},r,n,m,v,l=80,B=10)=>{const w=window.devicePixelRatio||1,h=new j(r,w);if(n.y+=B,r.beginPath(),r.lineWidth=.5,h.moveTo(n.x-8,n.y-m),h.lineTo(n.x-8+v.width/w-50,n.y-m),r.stroke(),r.font=`${12*w}px Arial`,h.fillText(e,n.x,n.y),o.length>20){const N=o.match(/.{1,20}/g);N.forEach((S,z)=>{h.fillText(S,n.x+l,n.y+z*m)}),n.y=n.y+N.length*m}else h.fillText(o,n.x+l,n.y),n.y+=m};return(o,e)=>{const r=T("el-button"),n=T("el-text"),m=T("el-input"),v=T("el-dialog");return u(),x(I,null,[g(Je,{show:D.value},null,8,["show"]),D.value?q("",!0):(u(),x("div",{key:0,class:"scroll-container",ref_key:"containerRef",ref:b},[$.value?(u(),x("div",{key:0,class:ke(["questionnaire-container",{"is-modifying":R.value}])},[te.value?(u(),k(Ve,{key:0,title:ee.value,scrollerRef:xe(b)},{right:c(()=>[R.value?(u(),k(r,{key:0,style:{width:"70px"},type:"primary",onClick:ue},{default:c(()=>e[5]||(e[5]=[V("预览")])),_:1})):q("",!0)]),_:1},8,["title","scrollerRef"])):q("",!0),e[10]||(e[10]=f("img",{class:"logo",src:H,alt:""},null,-1)),e[11]||(e[11]=f("div",{class:"main-title"},"上门喂养信息收集",-1)),(u(!0),x(I,null,W(L.value,(l,B)=>(u(),k($e,Te({order:B+1,key:B,ref_for:!0},l,{modelValue:t.value[l.field].value,"onUpdate:modelValue":w=>t.value[l.field].value=w}),null,16,["order","modelValue","onUpdate:modelValue"]))),128)),R.value?(u(),x(I,{key:1},[f("div",Me,[g(n,{type:"danger",style:{fontSize:"28px"}},{default:c(()=>e[6]||(e[6]=[V("备注")])),_:1}),g(m,{type:"textarea",modelValue:a.value,"onUpdate:modelValue":e[0]||(e[0]=l=>a.value=l),autosize:{minRows:5}},null,8,["modelValue"])]),f("div",Ie,[g(n,{type:"danger",style:{fontSize:"28px"}},{default:c(()=>e[7]||(e[7]=[V("标题")])),_:1}),g(m,{modelValue:s.value,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value=l)},null,8,["modelValue"])])],64)):q("",!0),g(r,{class:"submit-btn",type:"primary",onClick:le},{default:c(()=>[V(Q(R.value?"修改":"交给你啦"),1)]),_:1}),R.value?(u(),k(r,{key:2,class:"submit-btn",type:"danger",onClick:se},{default:c(()=>e[8]||(e[8]=[V("删除")])),_:1})):q("",!0),f("div",ze,[g(n,{type:"info"},{default:c(()=>e[9]||(e[9]=[V("我们将严格保密您的信息，仅用于服务安排。")])),_:1})])],2)):q("",!0)],512)),g(v,{modelValue:E.value,"onUpdate:modelValue":e[3]||(e[3]=l=>E.value=l)},{header:c(()=>e[12]||(e[12]=[f("span",null,"删除",-1)])),footer:c(()=>[g(r,{type:"primary",onClick:re},{default:c(()=>e[13]||(e[13]=[V("确认")])),_:1}),g(r,{onClick:e[2]||(e[2]=l=>E.value=!1)},{default:c(()=>e[14]||(e[14]=[V("取消")])),_:1})]),default:c(()=>[e[15]||(e[15]=f("span",null,"确认删除该问卷",-1))]),_:1},8,["modelValue"]),g(v,{modelValue:p.value,"onUpdate:modelValue":e[4]||(e[4]=l=>p.value=l),fullscreen:""},{header:c(()=>e[16]||(e[16]=[f("span",null,"预览",-1)])),footer:c(()=>e[17]||(e[17]=[])),default:c(()=>[f("img",{class:"preview-img",src:K.value,alt:""},null,8,Xe)]),_:1},8,["modelValue"])],64)}}});export{Ye as default};
